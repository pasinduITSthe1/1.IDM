# Escorts Feature - Visual Flow Diagram

## ğŸ“Š System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Flutter App                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Guest List  â”‚â”€â”€â”€â–¶â”‚ Guest Detailsâ”‚â”€â”€â”€â–¶â”‚Guest Escorts â”‚    â”‚
â”‚  â”‚   Screen     â”‚    â”‚    Modal     â”‚    â”‚   Screen     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                     â”‚            â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                       â–¼                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                          â”‚  Escort Registrationâ”‚             â”‚
â”‚                          â”‚      Screen         â”‚             â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â”‚                          â”‚
â”‚                                    â–¼                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                          â”‚   EscortProvider    â”‚             â”‚
â”‚                          â”‚  (State Management) â”‚             â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                    â”‚                          â”‚
â”‚                                    â–¼                          â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                          â”‚   EscortService     â”‚             â”‚
â”‚                          â”‚   (API Calls)       â”‚             â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â”‚ HTTP REST API
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Backend Server (Node.js)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                    â”‚   /api/escorts       â”‚                    â”‚
â”‚                    â”‚   REST Endpoints     â”‚                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                              â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MySQL Database                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ qlo_customer  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  guest_escorts   â”‚               â”‚
â”‚  â”‚   (Guests)    â”‚   FK    â”‚   (Escorts)      â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                     â”‚                           â”‚
â”‚                                     â”‚ FK                        â”‚
â”‚                                     â–¼                           â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚                            â”‚escort_attachmentsâ”‚                â”‚
â”‚                            â”‚    (Photos)      â”‚                â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ User Flow - Adding an Escort

### Option 1: Manual Entry
```
    Guest List Screen
           â”‚
           â–¼
    [Click Guest]
           â”‚
           â–¼
    Guest Details Modal
           â”‚
           â–¼
    [Manage Escorts & Companions]
           â”‚
           â–¼
    Guest Escorts Screen
           â”‚
           â–¼
    [+ Add Escort Button]
           â”‚
           â–¼
    Escort Registration Screen
           â”‚
           â–¼
    [Fill Form Manually]
           â”‚
           â–¼
    [Submit]
           â”‚
           â–¼
    âœ… Escort Saved
```

### Option 2: Document Scanning
```
    Guest List Screen
           â”‚
           â–¼
    [Click Guest]
           â”‚
           â–¼
    Guest Details Modal
           â”‚
           â–¼
    [Manage Escorts & Companions]
           â”‚
           â–¼
    Guest Escorts Screen
           â”‚
           â–¼
    [Scan Document Icon]
           â”‚
           â–¼
    MRZ Scanner Screen
           â”‚
           â–¼
    [Scan Passport/ID]
           â”‚
           â–¼
    ID Photo Capture Screen
           â”‚
           â–¼
    [Capture Front/Back]
           â”‚
           â–¼
    Escort Registration Screen
    (Auto-filled from scan)
           â”‚
           â–¼
    [Review & Submit]
           â”‚
           â–¼
    âœ… Escort Saved
```

## ğŸ“± Screen Components

### Guest Escorts Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€  Escorts & Companions          ğŸ”    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ John Doe                      â”‚ â”‚
â”‚  â”‚ Room 205                         â”‚ â”‚
â”‚  â”‚ [2 Escorts]                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ Jane Smith                    â”‚ â”‚
â”‚  â”‚ ğŸ‘¥ Family Member                 â”‚ â”‚
â”‚  â”‚ ğŸ“ Passport: AB123456           â”‚ â”‚
â”‚  â”‚ ğŸŒ USA                          ğŸ—‘â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ Mike Johnson                  â”‚ â”‚
â”‚  â”‚ ğŸ‘” Business Associate            â”‚ â”‚
â”‚  â”‚ ğŸ“ ID Card: CD789012            â”‚ â”‚
â”‚  â”‚ ğŸŒ UK                           ğŸ—‘â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚                               ğŸ” [FAB] â”‚
â”‚                               + [FAB] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Escort Registration Screen
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€  Add Escort/Companion                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ‘¤ Adding escort for: John Doe   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ âœ… Form auto-filled from scan    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“· Captured Photos               â”‚ â”‚
â”‚  â”‚ [Front Photo] [Back Photo]       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                        â”‚
â”‚  Relationship to Guest *               â”‚
â”‚  [â–¼ Companion]                         â”‚
â”‚                                        â”‚
â”‚  Document Type                         â”‚
â”‚  [Passport] [ID Card] [Visa]          â”‚
â”‚                                        â”‚
â”‚  First Name *                          â”‚
â”‚  [Jane                           ]    â”‚
â”‚                                        â”‚
â”‚  Last Name *                           â”‚
â”‚  [Smith                          ]    â”‚
â”‚                                        â”‚
â”‚  Document Number                       â”‚
â”‚  [AB123456                       ]    â”‚
â”‚                                        â”‚
â”‚  [... more fields ...]                â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      [Add Escort]                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ—„ï¸ Database Relationships

```
qlo_customer (Guests)
    â”œâ”€â”€ id_customer (PK)
    â”œâ”€â”€ firstname
    â”œâ”€â”€ lastname
    â””â”€â”€ ...
         â”‚
         â”‚ 1:N (One guest can have many escorts)
         â”‚
         â–¼
guest_escorts (Escorts)
    â”œâ”€â”€ id (PK)
    â”œâ”€â”€ id_customer (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”œâ”€â”€ first_name               â”‚
    â”œâ”€â”€ last_name                â”‚
    â”œâ”€â”€ relationship_to_guest    â”‚
    â””â”€â”€ ...                      â”‚
         â”‚                       â”‚
         â”‚ 1:N                   â”‚
         â”‚                       â”‚
         â–¼                       â”‚
escort_attachments              â”‚
    â”œâ”€â”€ id (PK)                 â”‚
    â”œâ”€â”€ id_escort (FK)          â”‚
    â”œâ”€â”€ attachment_type         â”‚
    â”œâ”€â”€ file_path               â”‚
    â””â”€â”€ ...                     â”‚
                                 â”‚
    ON DELETE CASCADE â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    (When guest deleted, all escorts and 
     their attachments are automatically deleted)
```

## ğŸ¯ Key Integration Points

### 1. Guest List Screen Update
```dart
// Added to guest details modal
OutlinedButton.icon(
  onPressed: () {
    Navigator.pop(context);
    context.push('/guest/${guest.id}/escorts', extra: guest);
  },
  icon: Icon(Icons.people_outline),
  label: Text('Manage Escorts & Companions'),
)
```

### 2. New Routes Added
```dart
// In app_routes.dart
GoRoute(
  path: '/guest/:guestId/escorts',
  name: 'guest-escorts',
  builder: (context, state) {
    final guest = state.extra as Guest;
    return GuestEscortsScreen(guest: guest);
  },
),
GoRoute(
  path: '/guest/:guestId/escorts/add',
  name: 'add-escort',
  builder: (context, state) {
    final extra = state.extra as Map<String, dynamic>;
    return EscortRegistrationScreen(
      guestId: extra['guestId'],
      guestName: extra['guestName'],
      scannedData: extra['scannedData'],
    );
  },
),
```

### 3. Provider Registration
```dart
// In main.dart
MultiProvider(
  providers: [
    ChangeNotifierProvider(create: (_) => AuthProvider()),
    ChangeNotifierProvider(create: (_) => GuestProvider()),
    ChangeNotifierProvider(create: (_) => CheckoutProvider()),
    ChangeNotifierProvider(create: (_) => EscortProvider()), // âœ¨ NEW
  ],
  // ...
)
```

## ğŸ“Š Data Flow Example

### Adding an Escort:
```
1. User Input (Flutter)
   â””â”€â–¶ firstName: "Jane", lastName: "Smith"

2. EscortProvider.addEscort()
   â””â”€â–¶ Creates Escort object with UUID

3. EscortService.addEscort()
   â””â”€â–¶ POST /api/escorts
       Body: {
         id_customer: 123,
         first_name: "Jane",
         last_name: "Smith",
         ...
       }

4. Backend API
   â””â”€â–¶ INSERT INTO guest_escorts ...

5. MySQL Database
   â””â”€â–¶ Returns: { id: 456, success: true }

6. EscortProvider
   â””â”€â–¶ Adds to local list, notifyListeners()

7. UI Updates
   â””â”€â–¶ Escort appears in list âœ…
```

## ğŸ¨ Color Scheme

```
Primary Actions:     AppTheme.primaryOrange (#FF6B35)
Secondary Actions:   AppTheme.secondaryOrange
Success:            Colors.green
Danger/Delete:      Colors.red
Info Cards:         Colors.grey.shade50
Borders:            Colors.grey.shade300
Text Primary:       Colors.black
Text Secondary:     Colors.grey.shade600
```

## ğŸ” Security Considerations

```
Frontend:
âœ“ Input validation
âœ“ Required field checks
âœ“ Email/phone format validation

Backend:
âœ“ Required field validation
âœ“ SQL injection prevention (parameterized queries)
âœ“ Error handling
âœ“ Data sanitization

Database:
âœ“ Foreign key constraints
âœ“ CASCADE delete
âœ“ Indexed fields for performance
âœ“ Proper data types
```

This visual guide helps understand how all the pieces fit together! ğŸ¯
